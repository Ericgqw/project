var DivCoor=function(){this.left=$("#report-div").offset().left;this.top=$("#report-div").offset().top;this.POSLEFT=40;this.POSTOP=18;this.baseLeft=0;this.baseTop=0;this.index=0;this.currentBox=null;this.boxs=new Array()};DivCoor.prototype.appendDiv=function(B,E){var F=$("<div></div>").addClass("drag-box").width(B).height(E);var A=$("<div><i class='icon iconfont icon-delete fa-lg red'></i></div>").addClass("drag-del");var D=$("<div></div>").addClass("drag-coor");var G=$("<div></div>").addClass("content").css("width","100%").css("height","100%");F.append(G).append(A).append(D).appendTo($("#div-coor"));this.bindEvent(F);this.bindTextEvent(F);this.index++;var C={};C["id"]=this.index;F.data("rd",C);this.boxs.push(F);F.offset({left:F.offset().left+10,top:F.offset().top-12});this.baseLeft=F.offset().left;this.baseTop=F.offset().top;C["baseLeft"]=this.baseLeft;C["baseTop"]=this.baseTop;C["type"]="div";C["content"]=new Content();C.mark=0};DivCoor.prototype.initDiv=function(E){var C=E.w;var F=E.h;var G=$("<div></div>").addClass("drag-box").width(C).height(F);var B=$("<div><i class='icon iconfont icon-delete fa-lg red'></i></div>").addClass("drag-del");var D=$("<div></div>").addClass("drag-coor");var H=$("<div></div>").addClass("content").css("width","100%").css("height","100%");G.append(H).append(B).append(D).appendTo($("#div-coor"));this.bindEvent(G);this.bindTextEvent(G);this.index=Math.max(this.index,E.id);G.data("rd",E);this.boxs.push(G);G.offset({left:G.offset().left+10,top:G.offset().top-12});this.baseLeft=G.offset().left;this.baseTop=G.offset().top;G.offset({left:this.baseLeft+E.x,top:this.baseTop+E.y});var A=E.content;if(A!=undefined&&A.orgName!=undefined){H.html(A.orgName)}E["type"]="div";E["baseLeft"]=this.baseLeft;E["baseTop"]=this.baseTop;E.mark=0};DivCoor.prototype.appendChartDiv=function(B,F,C,E){this.appendDiv(B,F);var G=$(this.boxs[this.boxs.length-1]);G.find(".content").empty().append(C);var A=new Content();A["chartType"]=E;var D=G.data("rd");A.initChart();D["content"]=A;D.mark=3};DivCoor.prototype.initChartDiv=function(B){var A=B.content;this.appendDiv(B.w,B.h);var C=A.chartType;var D=$(this.boxs[this.boxs.length-1]);var F=$("#win-chart").find("img");F.each(function(){if(parseInt($(this).attr("type"))==C){var G=$("<img>",{src:$(this).attr("big")});G.css("width",D.width()-2).css("height",D.height()-2);D.find(".content").empty().append(G)}});D.offset({left:this.baseLeft+B.x,top:this.baseTop+B.y});this.index=Math.max(this.index,B.id);var E=D.data("rd");E["content"]=A;E.mark=3;E.name=B.name;E.id=B.id};DivCoor.prototype.appendPanel=function(J,E,C,G){var A=this;var D=$("<div></div>").addClass("drag-box").width(J).height(E);var K=$("<div><i class='icon iconfont icon-delete fa-lg red'></i></div>").addClass("drag-del");var H=$("<div></div>").addClass("drag-coor");var F=$("<div></div>").addClass("content");D.append(F).append(K).append(H).appendTo($("#div-coor"));this.bindEvent(D);this.bindTextEvent(D);this.index++;var B={};B["id"]=this.index;D.data("rd",B);D.find(".content").empty().append(C);var I=new Content();I["chartType"]=G;I.initChart();B["content"]=I;this.boxs.push(D);D.offset({left:D.offset().left+10,top:D.offset().top-12});this.baseLeft=D.offset().left;this.baseTop=D.offset().top;B["baseLeft"]=this.baseLeft;B["baseTop"]=this.baseTop;B["type"]="panel";B.mark=3};DivCoor.prototype.appendCellPanel=function(B,D,C,H){var E=$("<div></div>").css("border","1px solid #CCCCCC;").css("width","100%").css("height","100%");var G=$("<div></div>").addClass("content").append(C);E.append(G);if(H.find("div").length==0){var A=$("<div></div>").addClass("sv").append(E);var F=$("<div></div>").append(A);F.css("overflow","hidden").css("position","relative").width(B).height(D).appendTo(H);A.width(B).height(D)}else{H.find("div.sv").empty().append(E)}};DivCoor.prototype.initChartPanel=function(B){var H=B.title!=undefined?B.title:"";var A=this;var D=$("<div></div>").addClass("drag-box").width(B.w).height(B.h);var I=$("<div><i class='icon iconfont icon-delete fa-lg red'></i></div>").addClass("drag-del");var F=$("<div></div>").addClass("drag-coor");var E=$("<div></div>").addClass("content");D.append(E).append(I).append(F).appendTo($("#div-coor"));this.bindEvent(D);this.bindTextEvent(D);D.data("rd",B);var G=B.content;var C=$("#win-chart").find("img");C.each(function(){if(parseInt($(this).attr("type"))==G.chartType){var J=$("<img>",{src:$(this).attr("big")});J.css("width",D.width()-2).css("height",D.height()-24-2);D.find(".content").empty().append(J)}});this.boxs.push(D);D.offset({left:D.offset().left+10,top:D.offset().top-12});this.baseLeft=D.offset().left;this.baseTop=D.offset().top;D.offset({left:this.baseLeft+B.x,top:this.baseTop+B.y});this.index=Math.max(this.index,B.id);B["baseLeft"]=this.baseLeft;B["baseTop"]=this.baseTop;B["type"]="panel";B.mark=3};DivCoor.prototype.appendSubReportPanel=function(H,D,E){var A=this;var C=$("<div></div>").addClass("drag-box").width(H).height(D);var I=$("<div><i class='icon iconfont icon-delete fa-lg red'></i></div>").addClass("drag-del");var G=$("<div></div>").addClass("drag-coor");var F=$("<div></div>").addClass("content");C.append(F).append(I).append(G).appendTo($("#div-coor"));this.bindEvent(C);this.bindTextEvent(C);this.index++;var B={};B["id"]=this.index;C.data("rd",B);C.find(".content").empty().append("<i class='icon iconfont icon-report fa-lg' style='font-size:16px'></i>");B["content"]=E;this.boxs.push(C);C.offset({left:C.offset().left+10,top:C.offset().top-12});this.baseLeft=C.offset().left;this.baseTop=C.offset().top;B["baseLeft"]=this.baseLeft;B["baseTop"]=this.baseTop;B["type"]="panel";B.mark=6};DivCoor.prototype.initSubReportPanel=function(E){var F=E.title!=undefined?E.title:"";var D=this;var C=$("<div></div>").addClass("drag-box").width(E.w).height(E.h);var A=$("<div><i class='icon iconfont icon-delete fa-lg red'></i></div>").addClass("drag-del");var B=$("<div></div>").addClass("drag-coor");var G=$("<div></div>").addClass("content");C.append(G).append(A).append(B).appendTo($("#div-coor"));this.bindEvent(C);this.bindTextEvent(C);C.data("rd",E);C.find(".content").empty().append("<i class='icon iconfont icon-report fa-lg' style='font-size:16px'></i>");this.boxs.push(C);C.offset({left:C.offset().left+10,top:C.offset().top-12});this.baseLeft=C.offset().left;this.baseTop=C.offset().top;C.offset({left:this.baseLeft+E.x,top:this.baseTop+E.y});this.index=Math.max(this.index,E.id);E["baseLeft"]=this.baseLeft;E["baseTop"]=this.baseTop;E["type"]="panel";E.mark=6};DivCoor.prototype.setTitle=function(B){if(this.currentBox==null){return }var A=this.currentBox.data("rd");A["title"]=B};DivCoor.prototype.setName=function(A){if(this.currentBox==null){return }var B=this.currentBox.data("rd");B["name"]=A};DivCoor.prototype.setPrinterFlag=function(B){if(this.currentBox==null){return }var A=this.currentBox.data("rd");A["printerFlag"]=B};DivCoor.prototype.setWidth=function(A){if(this.currentBox==null){return }this.currentBox.width(A)};DivCoor.prototype.setHeight=function(A){if(this.currentBox==null){return }this.currentBox.height(A)};DivCoor.prototype.setX=function(A){if(this.currentBox==null){return }this.currentBox.offset({left:this.baseLeft+parseInt(A)})};DivCoor.prototype.setY=function(A){if(this.currentBox==null){return }this.currentBox.offset({top:this.baseTop+parseInt(A)})};DivCoor.prototype.resetBox=function(){var A=this.boxs;for(var B=0;B<A.length;B++){$(A[B]).removeClass("box-active")}};DivCoor.prototype.deleteBox=function(D){var B=this.boxs;var A=-1;for(var C=0;C<B.length;C++){if(D==$(B[C]).data("rd").id){A=C;break}}if(A==-1){return }$(B[A]).remove();this.boxs.splice(A,1)};DivCoor.prototype.bindTextEvent=function(B){var A=this;B.bind("dblclick",function(F){var D=$(this).data("rd");if(D.mark==0){var G=$(this).find("div.content");var C=$("<textarea></textarea>").css("width","100%").css("height","100%");C.val(G.html());G.empty().append(C);C.focus();$(this).find("div.drag-del").hide();$(this).find("div.drag-coor").hide();var E=$(this);C.blur(function(){E.find("div.drag-del").show();E.find("div.drag-coor").show();var H=$(this).val();G.html(H)})}else{if(D.mark==3){var D=$(this).data("rd");anyExcel.chartsettting(D.content)}else{if(D.mark==6){var D=$(this).data("rd");$("li.tl-insert-panel-subreport").data("c",D.content);$("li.tl-insert-panel-subreport").trigger("click")}}}});B.bind("click",function(D){A.resetBox();$(this).addClass("box-active");A.currentBox=$(this);var C=A.currentBox.data("rd");if(C["type"]=="div"){anyExcel.setRightDivProperty($(this))}else{anyExcel.setRightPanelProperty($(this))}});B.find("div.drag-del").click(function(){var D=$(this).parent("div");var C=D.data("rd");A.deleteBox(C.id)})};DivCoor.prototype.bindEvent=function(F){var E=this;var B=null;var A=null;var D=function(J){if(B==null){return false}var I=B.posix;B.css({"top":J.pageY-I.y,"left":J.pageX-I.x});return false};var H=function(J){$(document).unbind("mousemove",D).unbind("mouseup",H);if(B==null){return false}var I=B.posix;B.css({"top":J.pageY-I.y,"left":J.pageX-I.x});B=null};var C=function(O){if(A==null){return false}var J=A.posix;var N=A.parent("div.drag-box");N.css({"width":Math.max(30,O.pageX-J.x+J.w),"height":Math.max(30,O.pageY-J.y+J.h)});var L=N.width();var I=N.height();var K=N.find("img");if(K.length>0){var M=N.data("rd");if(M.type=="div"){K.width(L-2).height(I-2)}else{K.width(L-2).height(I-24-2)}}return false};var G=function(O){$(document).unbind("mousemove",C).unbind("mouseup",G);if(A==null){return false}var J=A.posix;var N=A.parent("div.drag-box");N.css({"width":Math.max(30,O.pageX-J.x+J.w),"height":Math.max(30,O.pageY-J.y+J.h)});var M=N.data("rd");var L=N.width();var I=N.height();var K=N.find("img");if(K.length>0){if(M.type=="div"){K.width(L-2).height(I-2)}else{K.width(L-2).height(I-24-2)}}if(M["type"]=="div"){anyExcel.setRightDivProperty(N)}else{anyExcel.setRightPanelProperty(N)}A=null};F.mousedown(function(J){var L=$("#report-excel").scrollLeft();var I=$("#report-excel").scrollTop();var K=$(this).offset();B=$(this);B.posix={x:J.pageX-K.left-L+E.left,y:J.pageY-K.top-I+E.top};$(document).bind("mousemove",D).bind("mouseup",H)}).on("mousedown",".drag-coor",function(K){A=$(this);var J=A.parent("div.drag-box");var I={"w":J.width(),"h":J.height(),"x":K.pageX,"y":K.pageY};A.posix=I;$(document).bind("mousemove",C).bind("mouseup",G);return false})};DivCoor.prototype.unselected=function(){for(var A=0;A<this.boxs.length;A++){var B=$(this.boxs[A]);B.removeClass("box-active")}};DivCoor.prototype.getDivNames=function(){var B=new Array();for(var A=0;A<this.boxs.length;A++){var D=$(this.boxs[A]);var C=D.data("rd");if(C.type=="div"&&C.name!=undefined){B.push({id:C.id,name:C.name})}}return B};DivCoor.prototype.getPanelNames=function(){var A=new Array();for(var B=0;B<this.boxs.length;B++){var D=$(this.boxs[B]);var C=D.data("rd");if(C.type=="panel"&&C.name!=undefined){A.push({id:C.id,name:C.name})}}return A};DivCoor.prototype.getDivs=function(){if(this.boxs.length==0){return null}var B=new Array();for(var A=0;A<this.boxs.length;A++){var D=$(this.boxs[A]);var C=D.data("rd");if(C.type=="div"){B.push(D)}}return B};DivCoor.prototype.getPanels=function(){if(this.boxs.length==0){return null}var A=new Array();for(var B=0;B<this.boxs.length;B++){var D=$(this.boxs[B]);var C=D.data("rd");if(C.type=="panel"){A.push(D)}}return A};DivCoor.prototype.selectedTextDiv=function(){var B=this.currentBox;if(B==null){return null}var A=B.data("rd");if(A.type=="div"&&A.mark==0){return B}return null};DivCoor.prototype.setTextDivContent=function(A,B){var C=A.find("div.content");C.html(B)}