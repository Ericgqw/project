var Report=function(context,compAsync,relative){this.context=context;this.asyncs=eval(compAsync);this.relative=relative;this.curPage=0;this.endEPage=0};Report.prototype={getTargetLinkage:function(D,B,F){var A=this;var E=function(H,G,I){this.targetType=H;this.targetId=G;this.params=I};E.prototype.execute=function(){var J=this;var K=$("#rptId").val();var H={};H["rptId"]=K;H["_linkageId"]=this.targetId;H["_type"]=this.targetType;for(var I in this.params){H[I]=this.params[I]}var G=$("td[linkageId='"+B+"']");var L=G.attr("id");if(L!=undefined){H["_cellId"]=L}$.ajax({type:"POST",url:A.asynQueryUrl,data:H,dataType:"json",success:function(T){var R=T.type;var N=T.msg;if(N==null){return }if(R==1){var U="";if(type==1||type==2){U="chart_"+B}else{U="chart_"+G.attr("id")}if(U!=""){var S=chart.getChartById(U);S.resize(N)}}else{if(R==0){if(type==0){G.empty().html(N)}else{if(type==1||type==2){$("#"+B).empty().html(N)}}}else{if(R==2){if(type==0){var O=G.find("div.pbox");var P=null;if(O.length==0){P=G.children("div");P.empty().html(N)}else{var M=O.find("div.pbox-header");if(M.length==0){var Q=O.find("div.simplebar-content").length==0?O:O.find("div.simplebar-content");Q.empty().html(N)}else{M.next().remove();M.parent().append(N)}P=O}if(reportList){reportList.areaResize(P)}}else{$("#"+B).empty().html(N)}}}}}})};var C=new E(D,B,F);return C},getPanelBox:function(D,E){var B=this;var C=function(F,G){this.boxId=F;this.params=G};C.prototype.execute=function(){PageUI.loading();$.ajax({type:"POST",url:B.asynQueryBoxUrl,data:this.params,dataType:"json",success:function(J){PageUI.closeLoading();var F=J.type;var H=J.msg;if(F==1){var I="chart_"+D;var G=chart.getChartById(I);G.resize(H)}else{if(F==2){$("#"+D).empty().html(H)}}},error:function(F){PageUI.closeLoading()}})};var A=new C(D,E);return A},initAppReport:function(){this.contentUrl=this.context+"/report/app/list.htm";this.asynQueryUrl=this.context+"/report/asynQuery.htm";this.asynQueryBoxUrl=this.context+"/report/asynQueryBox.htm";this.asynCompQuery=this.context+"/report/asynCompQuery.htm";if(this.relative=="2"){var D=$("#arg-wrap").width()-20;var E=$("#arg-wrap").find("table");var B=parseInt(E.attr("ow"));var A=E.children("colgroup");var C=D/B;A.find("col").each(function(){var G=parseInt($(this).attr("ow"));var F=Math.floor(G*C);$(this).width(F)})}this.initInterval();this.initArg();this.loadContent();if($("#app-pagination").length>0){$("#app-pagination").find("li:eq(0)").click(function(){report.prePage()});$("#app-pagination").find("li:eq(2)").click(function(){report.nextPage()})}},initAppPreReport:function(E){this.contentUrl=this.context+"/report/app/pre/list.htm";this.asynQueryUrl=this.context+"/report/app/pre/asynQuery.htm";this.asynQueryBoxUrl=this.context+"/report/app/pre/asynQueryBox.htm";this.asynCompQuery=this.context+"/report/pre/asynCompQuery.htm";if(this.relative=="2"){var D=$("#arg-wrap").width();var F=$("#arg-wrap").find("table");var B=parseInt(F.attr("ow"));var A=F.children("colgroup");var C=D/B;A.find("col").each(function(){var H=parseInt($(this).attr("ow"));var G=Math.floor(H*C);$(this).width(G)})}this.initInterval();this.loadContent();this.initArg();if($("#app-pagination").length>0){$("#app-pagination").find("li:eq(0)").click(function(){report.prePage()});$("#app-pagination").find("li:eq(2)").click(function(){report.nextPage()})}},initFormReport:function(){this.contentUrl=this.context+"/form/app/list.htm";this.asynQueryUrl=this.context+"/report/asynQuery.htm";this.asynQueryBoxUrl=this.context+"/report/asynQueryBox.htm";this.asynCompQuery=this.context+"/report/asynCompQuery.htm";this.initInterval();this.loadContent();this.initArg();if($("#app-pagination").length>0){$("#app-pagination").find("li:eq(0)").click(function(){report.prePage()});$("#app-pagination").find("li:eq(2)").click(function(){report.nextPage()})}}};Report.prototype.initInterval=function(){var A=this;var B=parseInt($("#interval").val());if(B>0){var C=parseInt($("#timeType").val());if(C==0){B=B*1000}else{if(C==1){B=B*1000*60}else{if(C==2){B=B*1000*60*60}}}setInterval(function(){A.loadContentWithParam()},B)}};Report.prototype.contains=function(C,A){if(!A||A.length==0){return false}for(var B=0;B<A.length;B++){if(C==A[B]){return true}}return false};Report.prototype.resetQueryForm=function(){var A=new Array();A.push("rptId");A.push("formId");A.push("_curPage");A.push("_pageSize");this.resetArgForm($("#reportQuery-form"),A)};Report.prototype.resetArgForm=function(C,A){var B=this;$(C).find("input, textarea,select").each(function(){var D=$(this);if(B.contains(D.attr("name"),A)){return }if(D.is("input[type='hidden']")){D.val("")}else{if(D.is("input[type='text']")){D.val("")}else{if(D.is("input[type='password']")){D.val("")}else{if(D.is("select")){D.selectpicker("val","");D.val("")}else{if(D.is("input[type='radio']")){D.attr("checked",false)}}}}}})};Report.prototype.initArg=function(){var report=this;$("#btn-query-submit").click(function(){$("#ui-list-info-tool-arg").trigger("click");report.loadContentWithParam(true)});$("#btn-query-reset").click(function(){report.resetQueryForm();return false});$("input[type=radio]").change(function(){if($(this).is(":checked")){if($(this).attr("tq")!=undefined){report.btnQueryWithParam()}}});$("input[type=checkbox]").change(function(){if($(this).attr("tq")!=undefined){report.btnQueryWithParam()}});$("input.form_time").each(function(){$(this).attr("placeholder","日期选择");var format=$(this).attr("data-date-format");format=format==null?"yyyy-MM-dd":format;if(format.indexOf("ii")!=-1){format=format.replace("ii","mm")}var calendar=new lCalendar();calendar.init({"trigger":this,"format":format});if($(this).attr("tq")!=undefined){if(!$(this).hasClass("selectLinkage")){$(this).change(function(){report.btnQueryWithParam()})}}if($(this).val()!=""&&$(this).hasClass("selectLinkage")){report.linkageCond(this)}}).focus(function(){document.activeElement.blur()});$("input.selectpicker").each(function(){var json=eval("("+$(this).attr("data")+")");var triggerObj=$(this)[0];new MobileSelect({trigger:triggerObj,wheels:[{data:json}],callback:function(indexArr,data,trigger){var obj=data[0];$(trigger).val(obj.value);$(trigger).next().val(obj.id);$(trigger).trigger("change")}});if($(this).attr("tq")!=undefined){if(!$(this).hasClass("selectLinkage")){$(this).change(function(){report.btnQueryWithParam()})}}}).focus(function(){document.activeElement.blur()});$("input.input-tree").each(function(idx){var treeObj=new TreeObj(idx);treeObj.init($(this));var iconColor=$(this).attr("icon-color");if(iconColor!=undefined&&iconColor!=""){$(this).next().next().css("color",iconColor)}if($(this).attr("tq")!=undefined){if(!$(this).hasClass("selectLinkage")){$(this).change(function(){report.btnQueryWithParam()})}}}).focus(function(){document.activeElement.blur()});$(".selectLinkage").change(function(){report.linkageCond(this)})};Report.prototype.linkageCond=function(H){var F=this;var E=$(H);var B=E.attr("name");var K=E.val();var A=E.attr("linkageTarget");if(A==undefined){return }var G=A.split(",");for(var I=0;I<G.length;I++){var L=G[I];var J=$("input[name='"+L+"']");if(J.length>0){if(K==undefined||K==""){if(J.is("select")){J.empty();J.selectpicker("refresh")}else{J.val("")}var C=J.attr("linkageTarget");if(C!=undefined&&C!=""){this.linkageCond(J)}return }var D={rptId:$("#rptId").val(),_linkageTargetId:L};D[B]=K;$.ajax({async:false,type:"POST",url:F.asynCompQuery,data:D,dataType:"json",success:function(M){if(J.is("select")){J.empty().html(M);J.attr("title","").selectpicker("refresh")}else{J.val(M)}F.clearLinkTarget(J)},error:function(M){if(M.status==403){layer.open({content:"没有权限访问该页面",time:2})}else{if(M.status==401){layer.open({content:"会话失效，请重新登录系统",time:2})}}}})}}};Report.prototype.clearLinkTarget=function(B){var C=B.attr("linkageTarget");if(C!=undefined&&C!=""){var A=$("input[name='"+C+"']");if(A.length>0){if(B.is("select")){A.empty();A.selectpicker("refresh")}else{A.val("")}this.clearLinkTarget(A)}}};Report.prototype.asynArg=function(){$(".form_time").each(function(){var A=$(this);var B={rptId:$("#rptId").val(),_linkageTargetId:A.attr("name")};$.ajax({async:false,type:"POST",url:report.asynCompQuery,data:B,dataType:"json",success:function(C){if(C!=null&&C!=""){A.val(C)}},error:function(C){if(C.status==403){layer.open({content:"没有权限访问该页面",time:2})}else{if(C.status==401){layer.open({content:"会话失效，请重新登录系统",time:2})}}}})})};Report.prototype.loadContent=function(){PageUI.loading();var A=this;var B=this.getArgObject();$.ajax({type:"POST",url:this.contentUrl,data:B,dataType:"html",success:function(C){$("#table-content").empty().html(C);PageUI.closeLoading();var F=A.asyncs;if(!F){return }for(var E=0;E<F.length;E++){var D=F[E];A.setIntervalFunc(intervalLoad,D.exeInterval,D)}},error:function(C){PageUI.closeLoading()}})};var __sto=setInterval;Report.prototype.setIntervalFunc=function(E,C,D){var A=Array.prototype.slice.call(arguments,2);var B=function(){E.apply(null,A)};__sto(B,C)};var intervalLoad=function(D){var C=D.targetId;var E=D.type;report.asynArg();var B=report.getArgObject();B["_linkageId"]=C;B["_type"]=E;var A=$("td[linkageId='"+C+"']");var F=A.attr("id");if(F!=undefined){B["_cellId"]=F}$.ajax({type:"POST",url:report.asynQueryUrl,data:B,dataType:"json",success:function(N){var L=N.type;var H=N.msg;if(L==1){var O="";if(E==1||E==2){O="chart_"+C}else{O="chart_"+A.attr("id")}if(O!=""){var M=chart.getChartById(O);M.resize(H)}}else{if(L==0){if(E==0){A.empty().html(H)}else{if(E==1||E==2){$("#"+C).empty().html(H)}}}else{if(L==2){if(E==0){var I=A.find("div.pbox");var J=null;if(I.length==0){J=A.children("div");J.empty().html(H)}else{var G=I.find("div.pbox-header");if(G.length==0){var K=I.find("div.simplebar-content").length==0?I:I.find("div.simplebar-content");K.empty().html(H)}else{G.next().remove();G.parent().append(H)}J=I}if(reportList){reportList.areaResize(J)}}else{$("#"+C).empty().html(H)}}}}},error:function(G){if(G.status==403){layer.open({content:"没有权限访问该页面",time:2})}else{if(G.status==401){layer.open({content:"会话失效，请重新登录系统",time:2})}}}})};Report.prototype.getArgObject=function(){var A=new Object();$("#reportQuery-form").find("input").each(function(){if($(this).attr("type")=="button"){return true}var D=$(this).attr("name");if($(this).attr("type")=="checkbox"){if($(this).is(":checked")){var B=A[D];if(B==null||B==undefined){B=new Array();A[D]=B}B.push($(this).val())}return true}if($(this).attr("type")=="radio"){if($(this).is(":checked")){A[D]=$(this).val()}return true}var C=$(this).val();A[D]=C});return A};Report.prototype.btnQueryWithParam=function(){$("#ui-list-info-tool-arg").trigger("click");this.loadContentWithParam(true)};Report.prototype.loadContentWithParam=function(A){var C=this.getArgObject();var B;if(A){PageUI.loading()}$.ajax({type:"POST",url:this.contentUrl,data:C,dataType:"html",success:function(D){if(A){PageUI.closeLoading()}$("#table-content").empty().html(D)},error:function(D){if(A){PageUI.closeLoading()}}})};Report.prototype.reloadBox=function(B){var C={};$("#reportQuery-form").find(":input").each(function(){C[$(this).attr("name")]=$(this).val()});C["_boxId"]=B;var A=this.getPanelBox(B,C);A.execute()};Report.prototype.rptLinkage=function(F){if(F==null||F==undefined){return false}for(var D=0;D<F.length;D++){var C=F[D];var E=C.type;var A=C.targetId;var G=C.params;if(A==undefined||A==""){continue}var B=this.getTargetLinkage(E,A,G);B.execute()}return true};Report.prototype.setPage=function(A,B){this.curPage=A;this.endEPage=B;$("#app-pagination").find("li:eq(1)").empty().append(A+" / "+B)};Report.prototype.nextPage=function(){this.curPage=this.curPage+1;if(this.curPage>this.endEPage){this.curPage=this.endEPage;return }$("#curPage").val(this.curPage);report.loadContentWithParam()};Report.prototype.prePage=function(){this.curPage=this.curPage-1;if(this.curPage<1){this.curPage=1;return }$("#curPage").val(this.curPage);report.loadContentWithParam()}